<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Lista de Tarefas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8f9fa;
    }
    
    .preview-container {
      font-family: 'JetBrains Mono', monospace;
      white-space: pre;
      text-wrap: wrap;
      background-color: #e9ecef;
      padding: 1rem;
      border-radius: 0.25rem;
      line-height: 1.5;
      font-size: 0.9rem;
      
      text-overflow: ellipsis;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
    }
    
    .task-item {
      cursor: grab;
    }
    
    .task-item:active {
      cursor: grabbing;
    }
  </style>
</head>
<body>

<div class="container my-5">
  <h1 class="mb-5 fs-3">Gerador de Lista de Tarefas</h1>
  
  <!-- Task item class -->
  <div class="card d-none task-item"></div>
  
  <div class="row">
    <div class="col-md-6">
      <div class="mb-3">
        <label for="task-date" class="form-label">Data de execução</label>
        <input type="date" class="form-control" id="task-date">
      </div>
      
      <form method="post" action="#" class="input-group mb-3 d-flex flex-wrap">
        <label for="new-task" style="flex: 1"><input type="text" class="form-control" id="new-task" placeholder="Descrição da nova tarefa" autofocus required></label>
        <button class="btn btn-primary ms-2 rounded" type="submit" id="add-task-btn">Adicionar</button>
      </form>
      
      <ul class="list-group" id="task-list">
      </ul>
    </div>
    
    <div class="col-md-6">
      <h3 class="mb-3 fs-3 text-body-secondary">Pré-visualização do Arquivo TXT</h3>
      <div class="preview-container" id="preview"></div>
      <button class="btn btn-success mt-3" id="generate-txt-btn" accesskey="G" title="Atalho: letra G"><small class="border py-1 px-2 rounded border-success-subtle me-2">G</small>Gerar Arquivo TXT</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
  function formatCase(string) {
    return string.substring(0, 1).toUpperCase() + string.substring(1).toLowerCase();
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    const taskDate = document.getElementById('task-date');
    const newTaskInput = document.getElementById('new-task');
    const addTaskBtn = document.getElementById('add-task-btn');
    const taskList = document.getElementById('task-list');
    const preview = document.getElementById('preview');
    const generateTxtBtn = document.getElementById('generate-txt-btn');
    
    // Set default date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    taskDate.value = `${tomorrow.getFullYear()}-${('0' + (tomorrow.getMonth() + 1)).slice(-2)}-${('0' + tomorrow.getDate()).slice(-2)}`;
    
    let tasks = [];
    
    const updatePreview = () => {
      const date = taskDate.value;
      let previewContent = `- - - - - - - - - - - - - - - - - - - - - -\n\n`;
      previewContent += `${date} TASKS\n\n`;
      tasks.forEach(task => {
        previewContent += `[ ] ${formatCase(task)}\n`;
      });
      previewContent += `\n- - - - - - - - - - - - - - - - - - - - - -`;
      preview.textContent = previewContent;
    };
    
    const renderTasks = () => {
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex gap-1 justify-content-between align-items-center task-item';
        li.dataset.id = index;
        const text = document.createElement('span');
        text.style = `text-overflow: ellipsis; max-width: fit-content; overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical;`;
        text.textContent = task;
        li.appendChild(text);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-danger btn-sm';
        deleteBtn.textContent = 'Excluir';
        deleteBtn.onclick = () => {
          tasks.splice(index, 1);
          renderTasks();
          updatePreview();
        };
        
        li.appendChild(deleteBtn);
        taskList.appendChild(li);
      });
    };
    
    addTaskBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const taskText = newTaskInput.value.trim();
      if (taskText !== '') {
        tasks.push(taskText);
        newTaskInput.value = '';
        renderTasks();
        updatePreview();
      }
    });
    
    newTaskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addTaskBtn.click();
      }
    });
    
    taskDate.addEventListener('change', updatePreview);
    
    generateTxtBtn.addEventListener('click', () => {
      const text = preview.textContent;
      const blob = new Blob([text], {type: 'text/plain'});
      const anchor = document.createElement('a');
      anchor.download = `${taskDate.value.replace(/\W/g, "")}.txt`;
      anchor.href = window.URL.createObjectURL(blob);
      anchor.target = '_blank';
      anchor.style.display = 'none';
      document.body.appendChild(anchor);
      anchor.click();
      document.body.removeChild(anchor);
    });
    
    // Initialize SortableJS
    new Sortable(taskList, {
      animation: 150,
      onEnd: () => {
        const updatedTasks = [];
        const taskItems = taskList.querySelectorAll('.list-group-item');
        taskItems.forEach(item => {
          updatedTasks.push(item.textContent.replace('Excluir', '').trim());
        });
        tasks = updatedTasks;
        renderTasks();
        updatePreview();
      }
    });
    
    // Initial render
    updatePreview();
  });
</script>

</body>
</html>
